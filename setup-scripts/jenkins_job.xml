<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties/>
  <scm class="hudson.plugins.git.GitSCM" plugin="git@3.0.1">
    <configVersion>2</configVersion>
    <userRemoteConfigs>
      <hudson.plugins.git.UserRemoteConfig>
        <url>https://github.com/kenzanlabs/hello-karyon-rxnetty</url>
        <credentialsId>github_user</credentialsId>
      </hudson.plugins.git.UserRemoteConfig>
    </userRemoteConfigs>
    <branches>
      <hudson.plugins.git.BranchSpec>
        <name>*/master</name>
      </hudson.plugins.git.BranchSpec>
    </branches>
    <doGenerateSubmoduleConfigurations>false</doGenerateSubmoduleConfigurations>
    <submoduleCfg class="list"/>
    <extensions/>
  </scm>
  <canRoam>true</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers>
    <hudson.triggers.SCMTrigger>
      <spec>* * * * *</spec>
      <ignorePostCommitHooks>false</ignorePostCommitHooks>
    </hudson.triggers.SCMTrigger>
  </triggers>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.tasks.Shell>
      <command>rm -f propertyfile.txt
cat &lt;&lt;EOT &gt;&gt; propertyfile.txt
version: 1
BRANCH_NAME: $BRANCH_NAME
CHANGE_ID: $CHANGE_ID
CHANGE_URL: $CHANGE_URL
CHANGE_TITLE $CHANGE_TITLE
CHANGE_AUTHOR: $CHANGE_AUTHOR
CHANGE_AUTHOR_DISPLAY_NAME: $CHANGE_AUTHOR_DISPLAY_NAME
CHANGE_AUTHOR_EMAIL: $CHANGE_AUTHOR_EMAIL
CHANGE_TARGET: $CHANGE_TARGET
BUILD_NUMBER: $BUILD_NUMBER
BUILD_ID: $BUILD_ID
BUILD_DISPLAY_NAME: $BUILD_DISPLAY_NAME
JOB_NAME: $JOB_NAME
JOB_BASE_NAME: $JOB_BASE_NAME
BUILD_TAG: $BUILD_TAG
EXECUTOR_NUMBER: $EXECUTOR_NUMBER
NODE_NAME: $NODE_NAME
NODE_LABELS: $NODE_LABELS
WORKSPACE: $WORKSPACE
JENKINS_HOME: $JENKINS_HOME
JENKINS_URL: $JENKINS_URL
BUILD_URL: $BUILD_URL
JOB_URL: $JOB_URL
SVN_REVISION: $SVN_REVISION
SVN_URL: $SVN_URL
EOT

./gradlew clean packDeb
</command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>#!/bin/bash

declare -i release=1
declare -i version=1
declare apikey=&quot;%%APIKEY%%&quot;
declare user=&quot;%%BINTRAYUSER%%&quot;
declare workspaceurl=$WORKSPACE/build/distributions/

echo $workspaceurl

for f in /var/lib/jenkins/workspace/Build\ Hello\ World/build/distributions/*.deb;do
  filename=${f##*/}
  #echo $filename
  set -f
  nameparts=(${filename//_/ })
  #echo &quot;${nameparts[1]}&quot; #get version info
  IFS=&apos;-&apos; read -a versioninfo &lt;&lt;&lt; &quot;${nameparts[1]}&quot;

  version=${versioninfo[0]}
  release=${versioninfo[1]}
done
  echo $version
  echo $release

newVersion=&quot;microsoft/spinnakerHack/SpinnakerDemo/&quot;$version&quot;.&quot;$release
echo $newVersion
echo `/var/lib/jfrog/jfrog bt vc --user $user --key $apikey $newVersion`

#upload package
echo `/var/lib/jfrog/jfrog bt u --user $user --key $apikey --deb=trusty/release/all --publish=true /var/lib/jenkins/workspace/Build\ Hello\ World/build/distributions/* $newVersion`

#sign the package
#echo `/var/lib/jfrog/jfrog bt gsv --user $user --key $apikey $newVersion`

#publish version
echo `/var/lib/jfrog/jfrog bt vp --user $user --key $apikey $newVersion`
</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers/>
  <buildWrappers>
    <hudson.plugins.timestamper.TimestamperBuildWrapper plugin="timestamper@1.8.7"/>
  </buildWrappers>
</project>
